# Модуль 4: Retrieval-Augmented Generation (RAG)

## Описание модуля

В этом модуле вы научитесь создавать системы RAG (Retrieval-Augmented Generation), которые соединяют LLM с внешними источниками знаний. Это ключевая технология для создания AI-приложений, работающих с актуальной и специфичной для вашей организации информацией.

К концу модуля вы создадите **работающего QA-бота**, который отвечает на вопросы на основе ваших собственных документов.

## Зачем нужен RAG?

LLM имеют серьёзные ограничения:
- **Устаревшие знания** — модель знает только то, на чём обучалась (cutoff date)
- **Галлюцинации** — уверенная генерация неправдивой информации
- **Нет доступа к частным данным** — корпоративные документы, внутренние базы знаний

RAG решает эти проблемы, подключая модель к внешним источникам данных в реальном времени.

## Цели модуля

После прохождения модуля вы сможете:

- ✅ Понимать принципы работы RAG и его компоненты
- ✅ Создавать векторные представления текстов (эмбеддинги)
- ✅ Строить и использовать векторные базы данных
- ✅ Интегрировать поиск с генерацией ответов
- ✅ Оптимизировать качество и стоимость RAG-систем

## Что вы создадите

```
┌─────────────────────────────────────────────────────────────┐
│                      QA-бот на основе RAG                    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📄 Документы → 🔢 Эмбеддинги → 🗄️ Векторная БД            │
│                                                             │
│  ❓ Вопрос → 🔍 Семантический поиск → 📚 Релевантные доки   │
│                                                             │
│  📚 + ❓ → 🤖 LLM → 💬 Точный ответ с источниками          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## Структура модуля

### [Урок 1: Зачем нужен RAG?](lesson_1_why_rag.md)

**Темы:**
- Ограничения LLM: cutoff date, галлюцинации
- Концепция RAG: Retriever + Generator
- Демонстрация: сравнение ответов с RAG и без
- Сценарии применения

**Результат:** Понимание проблемы и её решения

**Время:** ~1.5 часа

---

### [Урок 2: Эмбеддинги и векторные базы](lesson_2_embeddings_vectors.md)

**Темы:**
- Что такое эмбеддинги — "координаты смысла"
- Получение эмбеддингов через API
- Векторные базы данных: FAISS, Chroma
- Семантический поиск
- Chunking — нарезка документов

**Результат:** Работающий семантический поиск по документам

**Время:** ~2 часа

---

### [Урок 3: Интеграция поиска и генерации](lesson_3_rag_pipeline.md)

**Темы:**
- Формирование промпта с контекстом
- Создание RAG pipeline end-to-end
- Практика: QA-бот по документации
- Улучшение качества ответов
- Оценка качества RAG

**Результат:** Полноценный QA-бот на своих документах

**Время:** ~2.5 часа

---

### [Урок 4: Улучшение и расширение RAG](lesson_4_advanced_rag.md)

**Темы:**
- Гибридный поиск (семантика + ключевые слова)
- Продвинутые стратегии chunking
- Query transformation: HyDE, multi-query
- Обновление базы знаний в production
- Мониторинг и оптимизация стоимости

**Результат:** Production-ready RAG система

**Время:** ~2 часа

---

## Общее время модуля: 8-10 часов

## Предварительные требования

### Знания (из предыдущих модулей):
- ✅ Модуль 1: Работа с LLM API, базовый промпт-инжиниринг
- ✅ Модуль 2: Продвинутые промпты, LLM-as-a-judge
- ✅ Модуль 3: Интеграция компонентов в приложение

### Программное обеспечение:
- Python 3.8+
- Библиотеки: `requests`, `python-dotenv`, `numpy`
- Для урока 2+: `faiss-cpu` или `chromadb`
- Аккаунт OpenRouter или OpenAI с API-ключом

### Установка зависимостей:
```bash
pip install requests python-dotenv numpy faiss-cpu chromadb
```

## Архитектура RAG

```
┌────────────────────────────────────────────────────────────────┐
│                    ИНДЕКСАЦИЯ (один раз)                        │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   📄 Документы                                                  │
│        │                                                       │
│        ▼                                                       │
│   ✂️ Chunking (нарезка на фрагменты)                           │
│        │                                                       │
│        ▼                                                       │
│   🔢 Embedding Model (text → vector)                           │
│        │                                                       │
│        ▼                                                       │
│   🗄️ Vector Database (хранение)                                │
│                                                                │
└────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                    ЗАПРОС (каждый раз)                          │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   ❓ Вопрос пользователя                                        │
│        │                                                       │
│        ▼                                                       │
│   🔢 Embedding Model (вопрос → vector)                         │
│        │                                                       │
│        ▼                                                       │
│   🔍 Semantic Search (поиск похожих)                           │
│        │                                                       │
│        ▼                                                       │
│   📚 Top-K релевантных документов                              │
│        │                                                       │
│        ▼                                                       │
│   📝 Формирование промпта (вопрос + документы)                 │
│        │                                                       │
│        ▼                                                       │
│   🤖 LLM (генерация ответа)                                    │
│        │                                                       │
│        ▼                                                       │
│   💬 Ответ с цитатами источников                               │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

## Интеграция с предыдущими модулями

### Из Модуля 1:
- Работа с OpenRouter API
- Базовый промпт-инжиниринг
- Понимание токенов и лимитов

### Из Модуля 2:
- LLM-as-a-judge для оценки качества RAG
- Управление контекстом
- Оптимизация промптов

### Из Модуля 3:
- Паттерны проектирования приложений
- Интеграция компонентов
- **SchoolBot + RAG**: добавление учебников как базы знаний

## Контрольные точки

### После Урока 1:
- [ ] Понимаете, что такое RAG и зачем он нужен
- [ ] Можете объяснить концепцию непрофессионалу
- [ ] Видите разницу между ответами с RAG и без

### После Урока 2:
- [ ] Умеете получать эмбеддинги через API
- [ ] Создали векторную базу данных
- [ ] Реализовали семантический поиск

### После Урока 3:
- [ ] Создали полный RAG pipeline
- [ ] Работает QA-бот на ваших документах
- [ ] Умеете оценивать качество системы

### После Урока 4:
- [ ] Знаете продвинутые техники улучшения
- [ ] Понимаете production considerations
- [ ] Готовы к финальному проекту

## Финальный проект

**Создание QA-бота по документации фреймворка/библиотеки:**

1. Собрать документацию (20+ страниц)
2. Построить RAG pipeline с оптимизациями
3. Добавить веб-интерфейс
4. Оценить качество на тестовых вопросах

## Дальнейшие шаги

После завершения модуля вы будете готовы к:

1. **Модуль 5: Агенты** — LLM с инструментами и автономными действиями
2. **Модуль 6: Финальный проект** — полноценное AI-приложение

## Полезные ссылки

### Документация:
- [OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)
- [FAISS Documentation](https://faiss.ai/)
- [Chroma Documentation](https://docs.trychroma.com/)

### Исследования:
- [RAG: Retrieval-Augmented Generation (Meta AI)](https://arxiv.org/abs/2005.11401)
- [HyDE: Hypothetical Document Embeddings](https://arxiv.org/abs/2212.10496)

### Инструменты:
- [LangChain RAG](https://python.langchain.com/docs/use_cases/question_answering/)
- [LlamaIndex](https://www.llamaindex.ai/)

---

**Готовы создать свою первую RAG-систему?** Переходите к [Уроку 1: Зачем нужен RAG?](lesson_1_why_rag.md)! 🚀

