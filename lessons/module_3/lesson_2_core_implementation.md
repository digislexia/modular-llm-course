# –£—Ä–æ–∫ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

## –í–≤–µ–¥–µ–Ω–∏–µ

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º —É—Ä–æ–∫–µ –º—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É SchoolBot –∏ —Å–æ–∑–¥–∞–ª–∏ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞. –¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –æ–∂–∏–≤–∏—Ç—å –Ω–∞—à–µ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞! –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –∫–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π, –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Å–∏—Å—Ç–µ–º—É –ø—Ä–æ–º–ø—Ç–æ–≤.

–ö –∫–æ–Ω—Ü—É —É—Ä–æ–∫–∞ SchoolBot —Å–º–æ–∂–µ—Ç —Ä–µ–∞–ª—å–Ω–æ –æ–±—ä—è—Å–Ω—è—Ç—å —à–∫–æ–ª—å–Ω—ã–µ —Ç–µ–º—ã –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç—ã, –≤—ã–±–∏—Ä–∞—è –ø–æ–¥—Ö–æ–¥—è—â—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏.

## –¶–µ–ª–∏ —É—Ä–æ–∫–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ:

- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —É—á–µ–±–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Ä–∞–±–æ—Ç–∞—é—â—É—é —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥ —à–∫–æ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É

## –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

- **–†–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞—é—â–∏–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á–∏
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞** ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π, —Å–æ—Ö—Ä–∞–Ω—è–µ–º–∞—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–°—Ç—Ä–∞—Ç–µ–≥–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º** ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º —Å–∂–∞—Ç–∏—è/–æ–±—Ä–µ–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
- **–ö–ª–∞—Å—Å-—Ñ–∞—Å–∞–¥** ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, —Å–∫—Ä—ã–≤–∞—é—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

## 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞ –º–æ–¥–µ–ª–µ–π

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–∑ –ú–æ–¥—É–ª—è 2

–í –º–æ–¥—É–ª–µ 2 –º—ã –∏–∑—É—á–∞–ª–∏ –º–Ω–æ–≥–æ–º–æ–¥–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥. –¢–µ–ø–µ—Ä—å –ø—Ä–∏–º–µ–Ω–∏–º —ç—Ç–∏ –∑–Ω–∞–Ω–∏—è:

- –ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Üí –±—ã—Å—Ç—Ä–∞—è –¥–µ—à—ë–≤–∞—è –º–æ–¥–µ–ª—å
- –°–ª–æ–∂–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è ‚Üí –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Üí fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ModelRouter (`router.py`)

```python
"""
–†–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –¥–ª—è SchoolBot.
–í—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏.
"""

import os
import time
import requests
from typing import Dict, List, Optional
from dotenv import load_dotenv

load_dotenv()


class ModelRouter:
    """
    –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ –ø–æ–¥ –∑–∞–¥–∞—á—É.
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥–µ–ª–∏.
    """
    
    def __init__(self):
        self.api_key = os.getenv("OPENROUTER_API_KEY")
        self.base_url = "https://openrouter.ai/api/v1/chat/completions"
        
        if not self.api_key:
            raise ValueError("‚ùå API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env")
        
        # –ú–æ–¥–µ–ª–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
        self.models = {
            "premium": [
                "anthropic/claude-3.5-sonnet",
                "openai/gpt-4-turbo",
            ],
            "balanced": [
                "meta-llama/llama-3-70b-instruct",
                "mistralai/mixtral-8x22b-instruct",
            ],
            "fast": [
                "meta-llama/llama-3-8b-instruct",
                "mistralai/mistral-7b-instruct",
            ]
        }
        
        # –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–¥–µ–ª–µ–π
        self.task_model_mapping = {
            "explain_complex": "premium",      # –°–ª–æ–∂–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            "explain_simple": "balanced",      # –ü—Ä–æ—Å—Ç—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            "generate_exam": "balanced",       # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
            "check_answer": "fast",            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
            "summarize": "balanced",           # –ö–æ–Ω—Å–ø–µ–∫—Ç—ã
            "tutor": "balanced",               # –†–µ–∂–∏–º —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞
            "quality_check": "fast",           # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
        }
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        self.usage_stats = {
            "requests": 0,
            "tokens_used": 0,
            "errors": 0
        }
    
    def select_model(self, task_type: str, complexity: str = "medium") -> str:
        """
        –í—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
        
        Args:
            task_type: –¢–∏–ø –∑–∞–¥–∞—á–∏ (explain_complex, generate_exam, –∏ —Ç.–¥.)
            complexity: –°–ª–æ–∂–Ω–æ—Å—Ç—å (easy, medium, hard)
            
        Returns:
            –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
        """
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –º–æ–¥–µ–ª–∏
        category = self.task_model_mapping.get(task_type, "balanced")
        
        # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        if complexity == "hard" and category == "balanced":
            category = "premium"
        elif complexity == "easy" and category == "balanced":
            category = "fast"
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        models_list = self.models.get(category, self.models["balanced"])
        return models_list[0]
    
    def send_request(self, 
                     messages: List[Dict], 
                     task_type: str = "explain_simple",
                     complexity: str = "medium",
                     max_tokens: int = 1500,
                     temperature: float = 0.7) -> Dict:
        """
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –∏ fallback.
        
        Args:
            messages: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞
            task_type: –¢–∏–ø –∑–∞–¥–∞—á–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
            complexity: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞
            max_tokens: –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
            temperature: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            
        Returns:
            Dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏–ª–∏ –æ—à–∏–±–∫–æ–π
        """
        # –í—ã–±–∏—Ä–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –º–æ–¥–µ–ª—å
        primary_model = self.select_model(task_type, complexity)
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–æ–∫ fallback –º–æ–¥–µ–ª–µ–π
        category = self.task_model_mapping.get(task_type, "balanced")
        fallback_models = self.models.get(category, [])[1:] + self.models["fast"]
        
        # –ü—Ä–æ–±—É–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –º–æ–¥–µ–ª—å –∏ fallback
        all_models = [primary_model] + fallback_models
        
        for model in all_models[:3]:  # –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
            result = self._try_model(model, messages, max_tokens, temperature)
            
            if result["success"]:
                return result
            
            print(f"‚ö†Ô∏è –ú–æ–¥–µ–ª—å {model} –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é...")
            time.sleep(1)  # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
        
        self.usage_stats["errors"] += 1
        return {
            "success": False,
            "error": "–í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."
        }
    
    def _try_model(self, model: str, messages: List[Dict],
                   max_tokens: int, temperature: float) -> Dict:
        """–ü—Ä–æ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏"""
        
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json",
            "HTTP-Referer": "https://github.com/schoolbot",
            "X-Title": "SchoolBot"
        }
        
        data = {
            "model": model,
            "messages": messages,
            "max_tokens": max_tokens,
            "temperature": temperature,
            "usage": {"include": True}
        }
        
        try:
            response = requests.post(
                self.base_url, 
                headers=headers, 
                json=data,
                timeout=60
            )
            response.raise_for_status()
            
            result = response.json()
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            self.usage_stats["requests"] += 1
            usage = result.get("usage", {})
            self.usage_stats["tokens_used"] += usage.get("total_tokens", 0)
            
            return {
                "success": True,
                "content": result["choices"][0]["message"]["content"],
                "model": model,
                "usage": usage
            }
            
        except requests.exceptions.Timeout:
            return {"success": False, "error": "–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞"}
        except requests.exceptions.HTTPError as e:
            return {"success": False, "error": f"HTTP –æ—à–∏–±–∫–∞: {e}"}
        except Exception as e:
            return {"success": False, "error": str(e)}
    
    def get_stats(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"""
        return self.usage_stats.copy()


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞
if __name__ == "__main__":
    router = ModelRouter()
    
    print("üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ –º–æ–¥–µ–ª–µ–π")
    print("="*50)
    
    # –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π
    test_cases = [
        ("explain_complex", "hard"),
        ("explain_simple", "easy"),
        ("check_answer", "medium"),
        ("generate_exam", "hard"),
    ]
    
    for task, complexity in test_cases:
        model = router.select_model(task, complexity)
        print(f"–ó–∞–¥–∞—á–∞: {task}, –°–ª–æ–∂–Ω–æ—Å—Ç—å: {complexity} ‚Üí –ú–æ–¥–µ–ª—å: {model}")
    
    print("\n" + "="*50)
    print("üì§ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ API")
    
    test_messages = [
        {"role": "system", "content": "–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤."},
        {"role": "user", "content": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ? –û—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ."}
    ]
    
    result = router.send_request(test_messages, "explain_simple", "easy")
    
    if result["success"]:
        print(f"‚úÖ –£—Å–ø–µ—à–Ω–æ! –ú–æ–¥–µ–ª—å: {result['model']}")
        print(f"üìù –û—Ç–≤–µ—Ç: {result['content'][:200]}...")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞: {result['error']}")
```

### üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è

–ü—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å, –æ—Ç–≤–µ—Ç—å—Ç–µ:
- –ö–∞–∫—É—é –º–æ–¥–µ–ª—å –≤—ã–±–µ—Ä–µ—Ç —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∑–∞–¥–∞—á–∏ `explain_complex` —Å–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é `hard`?
- –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É?

<details>
<summary>–û—Ç–≤–µ—Ç—ã</summary>

1. –î–ª—è `explain_complex` + `hard` –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "premium" (–Ω–∞–ø—Ä–∏–º–µ—Ä, Claude 3.5 Sonnet)
2. –†–æ—É—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç fallback –º–æ–¥–µ–ª–∏ –∏–∑ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞—Ç–µ–º –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "fast"
</details>

## 2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–∑ –ú–æ–¥—É–ª—è 2

–í —É—Ä–æ–∫–µ 4 –º–æ–¥—É–ª—è 2 –º—ã –∏–∑—É—á–∞–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:
- **–°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π
- **–†–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Å–∂–∏–º–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥** ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä—É–µ–º –æ–±–∞ –º–µ—Ç–æ–¥–∞

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ContextManager (`context.py`)

```python
"""
–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è SchoolBot.
–£–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
"""

from typing import Dict, List, Optional
from datetime import datetime


class ContextManager:
    """
    –£–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.
    """
    
    def __init__(self, 
                 max_messages: int = 20,
                 summary_threshold: int = 15,
                 keep_recent: int = 5):
        """
        Args:
            max_messages: –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
            summary_threshold: –ö–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ
            keep_recent: –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏ —Ä–µ–∑—é–º–µ
        """
        self.max_messages = max_messages
        self.summary_threshold = summary_threshold
        self.keep_recent = keep_recent
        
        # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        self.messages: List[Dict] = []
        
        # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–≤—Å–µ–≥–¥–∞ –≤ –Ω–∞—á–∞–ª–µ)
        self.system_prompt: Optional[str] = None
        
        # –†–µ–∑—é–º–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        self.context_summary: Optional[str] = None
        
        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
        self.session_start = datetime.now()
        self.topics_discussed: List[str] = []
    
    def set_system_prompt(self, prompt: str):
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç"""
        self.system_prompt = prompt
    
    def add_message(self, role: str, content: str, topic: str = None):
        """
        –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é.
        
        Args:
            role: 'user' –∏–ª–∏ 'assistant'
            content: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            topic: –¢–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è)
        """
        self.messages.append({
            "role": role,
            "content": content,
            "timestamp": datetime.now().isoformat()
        })
        
        if topic and topic not in self.topics_discussed:
            self.topics_discussed.append(topic)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ—Ä–∞ –ª–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        if len(self.messages) >= self.summary_threshold:
            self._manage_context()
    
    def get_messages_for_api(self) -> List[Dict]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è API.
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
        """
        result = []
        
        # 1. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        if self.system_prompt:
            result.append({
                "role": "system",
                "content": self.system_prompt
            })
        
        # 2. –†–µ–∑—é–º–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if self.context_summary:
            result.append({
                "role": "system",
                "content": f"–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —á–∞—Å—Ç–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞:\n{self.context_summary}"
            })
        
        # 3. –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        for msg in self.messages[-self.max_messages:]:
            result.append({
                "role": msg["role"],
                "content": msg["content"]
            })
        
        return result
    
    def _manage_context(self):
        """–£–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–∞–∑–º–µ—Ä–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞"""
        
        if len(self.messages) < self.summary_threshold:
            return
        
        # –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏—è (—Å—Ç–∞—Ä—ã–µ)
        old_messages = self.messages[:-self.keep_recent]
        
        # –°–æ–∑–¥–∞—ë–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ
        summary_parts = []
        for msg in old_messages:
            role = "–£—á–µ–Ω–∏–∫" if msg["role"] == "user" else "–ü–æ–º–æ—â–Ω–∏–∫"
            # –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            content_preview = msg["content"][:100]
            if len(msg["content"]) > 100:
                content_preview += "..."
            summary_parts.append(f"- {role}: {content_preview}")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—é–º–µ
        new_summary = "\n".join(summary_parts[-10:])  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø—É–Ω–∫—Ç–æ–≤ —Ä–µ–∑—é–º–µ
        
        if self.context_summary:
            self.context_summary = f"{self.context_summary}\n\n–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ:\n{new_summary}"
        else:
            self.context_summary = new_summary
        
        # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        self.messages = self.messages[-self.keep_recent:]
        
        print(f"üìù –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω. –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(self.messages)} —Å–æ–æ–±—â–µ–Ω–∏–π.")
    
    def get_topics(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—Å—É–∂–¥—ë–Ω–Ω—ã—Ö —Ç–µ–º"""
        return self.topics_discussed.copy()
    
    def get_session_info(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏–∏"""
        return {
            "start_time": self.session_start.isoformat(),
            "messages_count": len(self.messages),
            "topics": self.topics_discussed,
            "has_summary": self.context_summary is not None
        }
    
    def clear(self):
        """–û—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç"""
        self.messages = []
        self.context_summary = None
        self.topics_discussed = []
        self.session_start = datetime.now()
        print("üóëÔ∏è –ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞")
    
    def export_session(self) -> Dict:
        """–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"""
        return {
            "system_prompt": self.system_prompt,
            "messages": self.messages,
            "context_summary": self.context_summary,
            "topics": self.topics_discussed,
            "session_start": self.session_start.isoformat()
        }
    
    def import_session(self, data: Dict):
        """–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Å–µ—Å—Å–∏—é"""
        self.system_prompt = data.get("system_prompt")
        self.messages = data.get("messages", [])
        self.context_summary = data.get("context_summary")
        self.topics_discussed = data.get("topics", [])
        self.session_start = datetime.fromisoformat(
            data.get("session_start", datetime.now().isoformat())
        )
        print("üìÇ –°–µ—Å—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞")


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ContextManager")
    print("="*50)
    
    # –°–æ–∑–¥–∞—ë–º –º–µ–Ω–µ–¥–∂–µ—Ä —Å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∞
    ctx = ContextManager(max_messages=10, summary_threshold=8, keep_recent=3)
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    ctx.set_system_prompt("–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤.")
    
    # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
    test_messages = [
        ("user", "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è?", "–ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è"),
        ("assistant", "–ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è ‚Äî —ç—Ç–æ —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏..."),
        ("user", "–ü—Ä–∏–≤–µ–¥–∏ –ø—Ä–∏–º–µ—Ä", "–ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è"),
        ("assistant", "–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ y = x¬≤, —Ç–æ y' = 2x..."),
        ("user", "–ê —á—Ç–æ —Ç–∞–∫–æ–µ –∏–Ω—Ç–µ–≥—Ä–∞–ª?", "–∏–Ω—Ç–µ–≥—Ä–∞–ª"),
        ("assistant", "–ò–Ω—Ç–µ–≥—Ä–∞–ª ‚Äî —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è, –æ–±—Ä–∞—Ç–Ω–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—é..."),
        ("user", "–ö–∞–∫ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã?", "—Å–≤—è–∑—å"),
        ("assistant", "–ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞–ª —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ —Ç–µ–æ—Ä–µ–º—É –ù—å—é—Ç–æ–Ω–∞-–õ–µ–π–±–Ω–∏—Ü–∞..."),
        ("user", "–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ç–µ–æ—Ä–µ–º—É", "—Ç–µ–æ—Ä–µ–º–∞"),
        ("assistant", "–¢–µ–æ—Ä–µ–º–∞ –ù—å—é—Ç–æ–Ω–∞-–õ–µ–π–±–Ω–∏—Ü–∞ –≥–ª–∞—Å–∏—Ç, —á—Ç–æ..."),
    ]
    
    for role, content, *topic in test_messages:
        topic = topic[0] if topic else None
        ctx.add_message(role, content, topic)
        print(f"–î–æ–±–∞–≤–ª–µ–Ω–æ: {role[:4]}... | –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {len(ctx.messages)}")
    
    print("\n" + "="*50)
    print("üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏:")
    print(ctx.get_session_info())
    
    print("\nüìù –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è API:")
    api_messages = ctx.get_messages_for_api()
    for msg in api_messages:
        print(f"  [{msg['role']}]: {msg['content'][:50]}...")
```

## 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ SchoolAssistant

–¢–µ–ø–µ—Ä—å –æ–±—ä–µ–¥–∏–Ω–∏–º –≤—Å—ë –≤ –≥–ª–∞–≤–Ω–æ–º –∫–ª–∞—Å—Å–µ. –û–±–Ω–æ–≤–∏–º —Ñ–∞–π–ª `assistant.py`:

```python
"""
–ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å SchoolAssistant ‚Äî –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —è–¥—Ä–æ SchoolBot.
"""

import os
from typing import Dict, List, Optional
from config import (
    SUBJECTS, DIFFICULTY_LEVELS, DEFAULT_MODEL,
    CONTEXT_CONFIG, QUALITY_CONFIG
)
from prompts import PromptLibrary
from router import ModelRouter
from context import ContextManager


class SchoolAssistant:
    """
    –£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ —Å—Ç–∞—Ä—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤.
    –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π, –º–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –ø—Ä–æ–º–ø—Ç—ã.
    """
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–º–æ—â–Ω–∏–∫–∞ —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏"""
        # –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        self.current_subject = "–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
        self.current_grade = 11
        self.current_difficulty = "medium"
        self.current_exam_type = "ege"  # –∏–ª–∏ "oge"
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SchoolBot...")
        
        try:
            self.router = ModelRouter()
            print("   ‚úÖ –†–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π")
        except Exception as e:
            print(f"   ‚ùå –û—à–∏–±–∫–∞ —Ä–æ—É—Ç–µ—Ä–∞: {e}")
            self.router = None
        
        self.context = ContextManager(
            max_messages=CONTEXT_CONFIG["max_messages"],
            summary_threshold=CONTEXT_CONFIG["summary_threshold"],
            keep_recent=CONTEXT_CONFIG["keep_recent"]
        )
        print("   ‚úÖ –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞")
        
        self.prompts = PromptLibrary
        print("   ‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤")
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        self._update_system_prompt()
        
        print("\nüéì SchoolBot –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!")
        self._print_current_settings()
    
    def _update_system_prompt(self):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
        system_prompt = self.prompts.get_system_prompt(
            subject=self.current_subject,
            grade=self.current_grade,
            difficulty=self.current_difficulty
        )
        self.context.set_system_prompt(system_prompt)
    
    def _print_current_settings(self):
        """–í—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"""
        print(f"   –ü—Ä–µ–¥–º–µ—Ç: {self.current_subject}")
        print(f"   –ö–ª–∞—Å—Å: {self.current_grade}")
        print(f"   –°–ª–æ–∂–Ω–æ—Å—Ç—å: {self.current_difficulty}")
        print(f"   –≠–∫–∑–∞–º–µ–Ω: {self.current_exam_type.upper()}")
    
    # ==================== –û–°–ù–û–í–ù–´–ï –ú–ï–¢–û–î–´ ====================
    
    def explain_topic(self, topic: str) -> str:
        """
        –û–±—ä—è—Å–Ω—è–µ—Ç —Ç–µ–º—É –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.
        
        Args:
            topic: –¢–µ–º–∞ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            
        Returns:
            –ü–æ–Ω—è—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
        """
        if not self.router:
            return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        user_prompt = self.prompts.get_explain_prompt(
            topic=topic,
            grade=self.current_grade,
            difficulty=self.current_difficulty
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        self.context.add_message("user", f"–û–±—ä—è—Å–Ω–∏ —Ç–µ–º—É: {topic}", topic)
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è API
        messages = self.context.get_messages_for_api()
        messages.append({"role": "user", "content": user_prompt})
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞
        task_complexity = "hard" if self.current_difficulty == "hard" else "medium"
        task_type = "explain_complex" if task_complexity == "hard" else "explain_simple"
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        print(f"üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã '{topic}'...")
        result = self.router.send_request(
            messages=messages,
            task_type=task_type,
            complexity=task_complexity,
            max_tokens=2000,
            temperature=0.7
        )
        
        if result["success"]:
            explanation = result["content"]
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
            self.context.add_message("assistant", explanation)
            return explanation
        else:
            return f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {result['error']}"
    
    def create_summary(self, topic: str) -> str:
        """
        –°–æ–∑–¥–∞—ë—Ç –∫—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ —Ç–µ–º–µ.
        
        Args:
            topic: –¢–µ–º–∞ –¥–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–∞
            
        Returns:
            –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç
        """
        if not self.router:
            return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        user_prompt = self.prompts.get_summary_prompt(
            topic=topic,
            exam_type=self.current_exam_type
        )
        
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        self.context.add_message("user", f"–°–æ–∑–¥–∞–π –∫–æ–Ω—Å–ø–µ–∫—Ç: {topic}", topic)
        
        # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
        messages = self.context.get_messages_for_api()
        messages.append({"role": "user", "content": user_prompt})
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        print(f"üìã –°–æ–∑–¥–∞—é –∫–æ–Ω—Å–ø–µ–∫—Ç –ø–æ —Ç–µ–º–µ '{topic}'...")
        result = self.router.send_request(
            messages=messages,
            task_type="summarize",
            complexity=self.current_difficulty,
            max_tokens=1500,
            temperature=0.5
        )
        
        if result["success"]:
            summary = result["content"]
            self.context.add_message("assistant", summary)
            return summary
        else:
            return f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞: {result['error']}"
    
    def tutor_message(self, user_message: str, topic: str = None) -> str:
        """
        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞.
        
        Args:
            user_message: –°–æ–æ–±—â–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞
            topic: –¢–µ–∫—É—â–∞—è —Ç–µ–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
            
        Returns:
            –û—Ç–≤–µ—Ç —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞
        """
        if not self.router:
            return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        self.context.add_message("user", user_message, topic)
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞
        tutor_prompt = self.prompts.get_tutor_prompt(
            subject=self.current_subject,
            topic=topic or "–æ–±—â–∞—è —Ç–µ–º–∞",
            grade=self.current_grade,
            user_message=user_message
        )
        
        # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π
        messages = self.context.get_messages_for_api()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        # (–Ω–µ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–≥—Ä–æ–º–æ–∂–¥–∞—Ç—å)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        result = self.router.send_request(
            messages=messages,
            task_type="tutor",
            complexity=self.current_difficulty,
            max_tokens=1000,
            temperature=0.7
        )
        
        if result["success"]:
            response = result["content"]
            self.context.add_message("assistant", response)
            return response
        else:
            return f"‚ùå –û—à–∏–±–∫–∞: {result['error']}"
    
    def generate_exam(self, topic: str, exam_type: str = None, 
                      num_questions: int = 3) -> str:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠.
        (–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –£—Ä–æ–∫–µ 3)
        """
        if not self.router:
            return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
        
        exam = exam_type or self.current_exam_type
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
        user_prompt = self.prompts.get_exam_prompt(
            topic=topic,
            num_questions=num_questions,
            exam_type=exam,
            grade=self.current_grade,
            difficulty=self.current_difficulty
        )
        
        messages = self.context.get_messages_for_api()
        messages.append({"role": "user", "content": user_prompt})
        
        print(f"üìù –ì–µ–Ω–µ—Ä–∏—Ä—É—é {num_questions} –∑–∞–¥–∞–Ω–∏–π {exam.upper()} –ø–æ —Ç–µ–º–µ '{topic}'...")
        result = self.router.send_request(
            messages=messages,
            task_type="generate_exam",
            complexity=self.current_difficulty,
            max_tokens=2500,
            temperature=0.8
        )
        
        if result["success"]:
            return result["content"]
        else:
            return f"‚ùå –û—à–∏–±–∫–∞: {result['error']}"
    
    def check_answer(self, question: str, student_answer: str) -> str:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞.
        (–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –£—Ä–æ–∫–µ 3)
        """
        # –ó–∞–≥–ª—É—à–∫–∞ ‚Äî –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –£—Ä–æ–∫–µ 3
        return f"[–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –£—Ä–æ–∫–µ 3]"
    
    # ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
    
    def set_subject(self, subject: str) -> bool:
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–µ–¥–º–µ—Ç"""
        subject_lower = subject.lower()
        
        for subj_name, subj_info in SUBJECTS.items():
            if subject_lower == subj_name or subject_lower in subj_info["aliases"]:
                self.current_subject = subj_name
                self._update_system_prompt()
                print(f"‚úÖ –ü—Ä–µ–¥–º–µ—Ç: {subj_name} ‚Äî {subj_info['description']}")
                return True
        
        print(f"‚ùå –ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {subject}")
        print(f"   –î–æ—Å—Ç—É–ø–Ω—ã–µ: {', '.join(SUBJECTS.keys())}")
        return False
    
    def set_grade(self, grade: int) -> bool:
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞"""
        if grade in [9, 10, 11]:
            self.current_grade = grade
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ–º —Ç–∏–ø —ç–∫–∑–∞–º–µ–Ω–∞
            self.current_exam_type = "oge" if grade == 9 else "ege"
            self._update_system_prompt()
            print(f"‚úÖ –ö–ª–∞—Å—Å: {grade} ({self.current_exam_type.upper()})")
            return True
        
        print(f"‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å: {grade}. –î–æ–ø—É—Å—Ç–∏–º–æ: 9, 10, 11")
        return False
    
    def set_difficulty(self, difficulty: str) -> bool:
        """–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏"""
        if difficulty in DIFFICULTY_LEVELS:
            self.current_difficulty = difficulty
            self._update_system_prompt()
            info = DIFFICULTY_LEVELS[difficulty]
            print(f"‚úÖ –°–ª–æ–∂–Ω–æ—Å—Ç—å: {difficulty} ‚Äî {info['description']}")
            return True
        
        print(f"‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å: {difficulty}")
        print(f"   –î–æ–ø—É—Å—Ç–∏–º–æ: {', '.join(DIFFICULTY_LEVELS.keys())}")
        return False
    
    def get_settings(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"""
        return {
            "subject": self.current_subject,
            "grade": self.current_grade,
            "difficulty": self.current_difficulty,
            "exam_type": self.current_exam_type
        }
    
    # ==================== –°–ï–°–°–ò–ò ====================
    
    def get_history(self) -> List[Dict]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–µ—Å—Å–∏–∏"""
        return self.context.messages.copy()
    
    def get_topics(self) -> List[str]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—Å—É–∂–¥—ë–Ω–Ω—ã—Ö —Ç–µ–º"""
        return self.context.get_topics()
    
    def clear_history(self):
        """–û—á–∏—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é"""
        self.context.clear()
    
    def get_stats(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"""
        router_stats = self.router.get_stats() if self.router else {}
        session_info = self.context.get_session_info()
        
        return {
            "router": router_stats,
            "session": session_info
        }


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
if __name__ == "__main__":
    print("\n" + "="*60)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï SCHOOLASSISTANT")
    print("="*60)
    
    # –°–æ–∑–¥–∞—ë–º –ø–æ–º–æ—â–Ω–∏–∫–∞
    bot = SchoolAssistant()
    
    print("\n" + "-"*40)
    print("–¢–µ—Å—Ç 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫")
    print("-"*40)
    bot.set_subject("—Ñ–∏–∑–∏–∫–∞")
    bot.set_grade(10)
    bot.set_difficulty("medium")
    
    print("\n" + "-"*40)
    print("–¢–µ—Å—Ç 2: –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã")
    print("-"*40)
    explanation = bot.explain_topic("–∑–∞–∫–æ–Ω –û–º–∞")
    print(f"\nüìö –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:\n{explanation[:500]}...")
    
    print("\n" + "-"*40)
    print("–¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞")
    print("-"*40)
    summary = bot.create_summary("–∑–∞–∫–æ–Ω—ã –ù—å—é—Ç–æ–Ω–∞")
    print(f"\nüìã –ö–æ–Ω—Å–ø–µ–∫—Ç:\n{summary[:500]}...")
    
    print("\n" + "-"*40)
    print("–¢–µ—Å—Ç 4: –†–µ–∂–∏–º —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞")
    print("-"*40)
    response = bot.tutor_message("–Ø –Ω–µ –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É —Ç–µ–ª–∞ –ø–∞–¥–∞—é—Ç —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –≤ –≤–∞–∫—É—É–º–µ?")
    print(f"\nüë®‚Äçüè´ –û—Ç–≤–µ—Ç —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞:\n{response[:500]}...")
    
    print("\n" + "-"*40)
    print("–¢–µ—Å—Ç 5: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    print("-"*40)
    stats = bot.get_stats()
    print(f"üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {stats}")
```

## 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLI

–¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–∏–º `main.py`, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

```python
"""
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ SchoolBot ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π CLI —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.
"""

import sys
from assistant import SchoolAssistant


def print_help():
    """–í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"""
    help_text = """
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    üéì SchoolBot ‚Äî –°–ø—Ä–∞–≤–∫–∞                       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë  –û–ë–£–ß–ï–ù–ò–ï:                                                      ‚ïë
‚ïë  /explain [—Ç–µ–º–∞]     ‚Äî –æ–±—ä—è—Å–Ω–∏—Ç—å —Ç–µ–º—É –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º           ‚ïë
‚ïë  /exam [—Ç–µ–º–∞] [n]    ‚Äî —Å–æ–∑–¥–∞—Ç—å n –∑–∞–¥–∞–Ω–∏–π –û–ì–≠/–ï–ì–≠ (–ø–æ —É–º–æ–ª—á. 3) ‚ïë
‚ïë  /summarize [—Ç–µ–º–∞]   ‚Äî —Å–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–π –∫–æ–Ω—Å–ø–µ–∫—Ç                ‚ïë
‚ïë  [–ª—é–±–æ–π —Ç–µ–∫—Å—Ç]       ‚Äî —Ä–µ–∂–∏–º —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞ (–¥–∏–∞–ª–æ–≥)               ‚ïë
‚ïë                                                                 ‚ïë
‚ïë  –ù–ê–°–¢–†–û–ô–ö–ò:                                                     ‚ïë
‚ïë  /subject [–ø—Ä–µ–¥–º–µ—Ç]  ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, —Ñ–∏–∑–∏–∫–∞, –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞...      ‚ïë
‚ïë  /grade [9/10/11]    ‚Äî –∫–ª–∞—Å—Å (–≤–ª–∏—è–µ—Ç –Ω–∞ –û–ì–≠/–ï–ì–≠)               ‚ïë
‚ïë  /level [easy/medium/hard] ‚Äî —Å–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–π              ‚ïë
‚ïë  /settings           ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏              ‚ïë
‚ïë                                                                 ‚ïë
‚ïë  –°–ï–°–°–ò–Ø:                                                        ‚ïë
‚ïë  /history            ‚Äî –æ–±—Å—É–∂–¥—ë–Ω–Ω—ã–µ —Ç–µ–º—ã                        ‚ïë
‚ïë  /stats              ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                ‚ïë
‚ïë  /clear              ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é                        ‚ïë
‚ïë                                                                 ‚ïë
‚ïë  /help ‚Äî —Å–ø—Ä–∞–≤–∫–∞  |  /exit ‚Äî –≤—ã—Ö–æ–¥                             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
"""
    print(help_text)


def print_welcome():
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    welcome = """
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                 ‚ïë
‚ïë     üéì –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SchoolBot!                           ‚ïë
‚ïë                                                                 ‚ïë
‚ïë     –£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠ –∏ –ï–ì–≠                  ‚ïë
‚ïë                                                                 ‚ïë
‚ïë     ‚Ä¢ –û–±—ä—è—Å–Ω—é –ª—é–±—É—é —Ç–µ–º—É –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º                        ‚ïë
‚ïë     ‚Ä¢ –°–æ–∑–¥–∞–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏                     ‚ïë
‚ïë     ‚Ä¢ –ü–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö                      ‚ïë
‚ïë                                                                 ‚ïë
‚ïë     –í–≤–µ–¥–∏—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥                            ‚ïë
‚ïë                                                                 ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
"""
    print(welcome)


def parse_command(user_input: str) -> tuple:
    """–†–∞–∑–±–∏—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    parts = user_input.strip().split(maxsplit=1)
    command = parts[0].lower() if parts else ""
    args = parts[1] if len(parts) > 1 else ""
    return command, args


def main():
    """–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    print_welcome()
    
    # –°–æ–∑–¥–∞—ë–º –ø–æ–º–æ—â–Ω–∏–∫–∞
    try:
        assistant = SchoolAssistant()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: {e}")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env —Å API –∫–ª—é—á–æ–º")
        return
    
    print("\nüí° –°–æ–≤–µ—Ç: –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞")
    print("   –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã /explain, /exam, /summarize\n")
    
    # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
    while True:
        try:
            user_input = input("\nüìù –í—ã: ").strip()
            
            if not user_input:
                continue
            
            command, args = parse_command(user_input)
            
            # === –í–´–•–û–î ===
            if command in ["/exit", "/quit", "/q"]:
                stats = assistant.get_stats()
                print(f"\nüìä –ó–∞ —Å–µ—Å—Å–∏—é: {stats['router'].get('requests', 0)} –∑–∞–ø—Ä–æ—Å–æ–≤")
                print("üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏! –£–¥–∞—á–∏ –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–∞—Ö!")
                break
            
            # === –°–ü–†–ê–í–ö–ê ===
            elif command == "/help":
                print_help()
            
            # === –ù–ê–°–¢–†–û–ô–ö–ò ===
            elif command == "/settings":
                settings = assistant.get_settings()
                print(f"\n‚öôÔ∏è –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:")
                print(f"   üìö –ü—Ä–µ–¥–º–µ—Ç: {settings['subject']}")
                print(f"   üéì –ö–ª–∞—Å—Å: {settings['grade']}")
                print(f"   üìä –°–ª–æ–∂–Ω–æ—Å—Ç—å: {settings['difficulty']}")
                print(f"   üìù –≠–∫–∑–∞–º–µ–Ω: {settings['exam_type'].upper()}")
            
            elif command == "/subject":
                if args:
                    assistant.set_subject(args)
                else:
                    from config import SUBJECTS
                    print("üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:")
                    for name, info in SUBJECTS.items():
                        print(f"   ‚Ä¢ {name} ‚Äî {info['description']}")
            
            elif command == "/grade":
                if args:
                    try:
                        assistant.set_grade(int(args))
                    except ValueError:
                        print("‚ùå –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–ª–∞—Å—Å–∞: /grade 11")
                else:
                    print("‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–ª–∞—Å—Å: /grade 9, /grade 10 –∏–ª–∏ /grade 11")
            
            elif command == "/level":
                if args:
                    assistant.set_difficulty(args)
                else:
                    from config import DIFFICULTY_LEVELS
                    print("üìä –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:")
                    for level, info in DIFFICULTY_LEVELS.items():
                        print(f"   ‚Ä¢ {level} ‚Äî {info['description']}")
            
            # === –û–ë–£–ß–ï–ù–ò–ï ===
            elif command == "/explain":
                if args:
                    result = assistant.explain_topic(args)
                    print(f"\nüìö –û–ë–™–Ø–°–ù–ï–ù–ò–ï:\n{'‚îÄ'*40}\n{result}\n{'‚îÄ'*40}")
                else:
                    print("‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É: /explain –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è")
            
            elif command == "/exam":
                if args:
                    # –ü–∞—Ä—Å–∏–º: /exam —Ç–µ–º–∞ [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ]
                    parts = args.rsplit(maxsplit=1)
                    topic = parts[0]
                    num = 3
                    if len(parts) > 1 and parts[1].isdigit():
                        num = int(parts[1])
                        topic = parts[0]
                    
                    result = assistant.generate_exam(topic, num_questions=num)
                    print(f"\nüìù –ó–ê–î–ê–ù–ò–Ø {assistant.current_exam_type.upper()}:\n{'‚îÄ'*40}\n{result}\n{'‚îÄ'*40}")
                else:
                    print("‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É: /exam –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ 5")
            
            elif command == "/summarize":
                if args:
                    result = assistant.create_summary(args)
                    print(f"\nüìã –ö–û–ù–°–ü–ï–ö–¢:\n{'‚îÄ'*40}\n{result}\n{'‚îÄ'*40}")
                else:
                    print("‚ùå –£–∫–∞–∂–∏—Ç–µ —Ç–µ–º—É: /summarize –∑–∞–∫–æ–Ω—ã —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∏")
            
            # === –°–ï–°–°–ò–Ø ===
            elif command == "/history":
                topics = assistant.get_topics()
                if topics:
                    print(f"\nüìú –û–±—Å—É–∂–¥—ë–Ω–Ω—ã–µ —Ç–µ–º—ã: {', '.join(topics)}")
                else:
                    print("üìú –¢–µ–º—ã –µ—â—ë –Ω–µ –æ–±—Å—É–∂–¥–∞–ª–∏—Å—å")
            
            elif command == "/stats":
                stats = assistant.get_stats()
                print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
                print(f"   –ó–∞–ø—Ä–æ—Å–æ–≤: {stats['router'].get('requests', 0)}")
                print(f"   –¢–æ–∫–µ–Ω–æ–≤: {stats['router'].get('tokens_used', 0)}")
                print(f"   –°–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ—Å—Å–∏–∏: {stats['session'].get('messages_count', 0)}")
            
            elif command == "/clear":
                assistant.clear_history()
            
            # === –†–ï–ñ–ò–ú –†–ï–ü–ï–¢–ò–¢–û–†–ê ===
            else:
                if user_input.startswith("/"):
                    print(f"‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: {command}")
                    print("   –í–≤–µ–¥–∏—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥")
                else:
                    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –≤–æ–ø—Ä–æ—Å —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—É
                    print("\nü§î –î—É–º–∞—é...")
                    result = assistant.tutor_message(user_input)
                    print(f"\nüë®‚Äçüè´ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä:\n{'‚îÄ'*40}\n{result}\n{'‚îÄ'*40}")
        
        except KeyboardInterrupt:
            print("\n\nüëã –î–æ –≤—Å—Ç—Ä–µ—á–∏!")
            break
        except Exception as e:
            print(f"\n‚ùå –û—à–∏–±–∫–∞: {e}")


if __name__ == "__main__":
    main()
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### üü¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python router.py` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
- –†–æ—É—Ç–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
- –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

**–ó–∞–¥–∞–Ω–∏–µ 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python context.py` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤**
–°–æ–∑–¥–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ:
- –Ø–≤–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã —Å —á–∏—Å–ª–∞–º–∏
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (–æ–ø–∏—Å–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Å–ª–æ–≤–∞–º–∏)

**–ó–∞–¥–∞–Ω–∏–µ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º**
–†–∞—Å—à–∏—Ä—å—Ç–µ `ContextManager`, —á—Ç–æ–±—ã –æ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ª:
- –°–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–¥–∞–Ω–æ –ø–æ –∫–∞–∂–¥–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É
- –ö–∞–∫–∏–µ —Ç–µ–º—ã –≤—ã–∑–≤–∞–ª–∏ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤

### üî¥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 5: –£–º–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ –ø–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é**
–î–æ–±–∞–≤—å—Ç–µ –≤ `ModelRouter` –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞:
- –ï—Å–ª–∏ –≤ –≤–æ–ø—Ä–æ—Å–µ –µ—Å—Ç—å —Ñ–æ—Ä–º—É–ª—ã/—á–∏—Å–ª–∞ ‚Üí –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å
- –ï—Å–ª–∏ –Ω—É–∂–µ–Ω —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç ‚Üí –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–ó–∞–¥–∞–Ω–∏–µ 6: –†–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ LLM**
–ò–∑–º–µ–Ω–∏—Ç–µ `ContextManager._manage_context()` —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–µ–∑—é–º–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å —Å –ø–æ–º–æ—â—å—é LLM, –∞ –Ω–µ –ø—Ä–æ—Å—Ç—ã–º –æ–±—Ä–µ–∑–∞–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞.

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ö–∞–∫ —Ä–æ—É—Ç–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á–∏?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –†–æ—É—Ç–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞–ø–ø–∏–Ω–≥ task_model_mapping, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ç–∏–ø—ã –∑–∞–¥–∞—á —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –º–æ–¥–µ–ª–µ–π. –ó–∞—Ç–µ–º —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: –¥–ª—è hard –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è premium –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –¥–ª—è easy ‚Äî fast. –ü–µ—Ä–≤–∞—è –º–æ–¥–µ–ª—å –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π.
   </details>

2. **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ summary_threshold —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç _manage_context(): —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ keep_recent –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
   </details>

3. **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∏ –∫–æ–≥–¥–∞ –æ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∑–∞–¥–∞—ë—Ç —Ä–æ–ª—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –º–æ–¥–µ–ª–∏ (–ø—Ä–µ–¥–º–µ—Ç, –∫–ª–∞—Å—Å, —Å–ª–æ–∂–Ω–æ—Å—Ç—å). –û–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ _update_system_prompt(), —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–∞ —Å–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã.
   </details>

4. **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback –≤ —Ä–æ—É—Ç–µ—Ä–µ?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É, —Ä–æ—É—Ç–µ—Ä –ø—Ä–æ–±—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –∏–∑ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞—Ç–µ–º –º–æ–¥–µ–ª–∏ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "fast". –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –ø–∞—É–∑–æ–π 1 —Å–µ–∫—É–Ω–¥—É –º–µ–∂–¥—É –Ω–∏–º–∏.
   </details>

5. **–ü–æ—á–µ–º—É –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤. –î–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏–π (0.7) –Ω—É–∂–Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å. –î–ª—è –∫–æ–Ω—Å–ø–µ–∫—Ç–æ–≤ (0.5) –≤–∞–∂–Ω–µ–µ —Ç–æ—á–Ω–æ—Å—Ç—å. –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π (0.8) –Ω—É–∂–Ω–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ. –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω—É–∂–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å.
   </details>

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ —É—Ä–æ–∫–∞

### –ß—Ç–æ –º—ã –∏–∑—É—á–∏–ª–∏

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–µ —è–¥—Ä–æ SchoolBot:

- **ModelRouter** ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —Å fallback
- **ContextManager** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ SchoolAssistant
- **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π CLI** ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º

### –°–≤—è–∑—å —Å –ú–æ–¥—É–ª–µ–º 2

–ú—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –∑–Ω–∞–Ω–∏—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –º–æ–¥—É–ª—è:
- –£—Ä–æ–∫ 2: –ú–Ω–æ–≥–æ–º–æ–¥–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ ‚Üí –Ω–∞—à ModelRouter
- –£—Ä–æ–∫ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º ‚Üí –Ω–∞—à ContextManager
- –£—Ä–æ–∫ 3: –ö–æ–Ω—Ü–µ–ø—Ü–∏—è LLM-as-a-judge ‚Üí –¥–æ–±–∞–≤–∏–º –≤ –£—Ä–æ–∫–µ 3

### –ß—Ç–æ –Ω–∞—Å –∂–¥—ë—Ç –¥–∞–ª—å—à–µ

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ **"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π"** –º—ã:
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º LLM-as-a-judge –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- –°–æ–∑–¥–∞–¥–∏–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠
- –î–æ–±–∞–≤–∏–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å

üöÄ **–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!** SchoolBot —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç:
- ‚úÖ –û–±—ä—è—Å–Ω—è—Ç—å —Ç–µ–º—ã –∏–∑ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- ‚úÖ –í–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞
- ‚úÖ –í—ã–±–∏—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–¥–∞—á–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π

**–ì–æ—Ç–æ–≤—ã –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?** –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ [–£—Ä–æ–∫—É 3: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](lesson_3_smart_features.md)!

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- [Facade Pattern](https://refactoring.guru/design-patterns/facade)
- [Strategy Pattern](https://refactoring.guru/design-patterns/strategy)

### –†–∞–±–æ—Ç–∞ —Å API:
- [Requests Library](https://docs.python-requests.org/)
- [OpenRouter Documentation](https://openrouter.ai/docs)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:
- [State Management Patterns](https://martinfowler.com/eaaDev/EventSourcing.html)

