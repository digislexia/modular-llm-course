# –£—Ä–æ–∫ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## –í–≤–µ–¥–µ–Ω–∏–µ

–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É—Ä–æ–∫–∞—Ö –º—ã —Å–æ–∑–¥–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–µ —è–¥—Ä–æ SchoolBot —Å —Ä–æ—É—Ç–∏–Ω–≥–æ–º –º–æ–¥–µ–ª–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º. –¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–∏—Ç—å "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" ‚Äî —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–¥–µ–ª–∞—é—Ç –Ω–∞—à–µ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞ –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É —É–º–Ω—ã–º:

- **LLM-as-a-judge** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤** ‚Äî –∑–∞–¥–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å —É—á–µ–Ω–∏–∫–∞
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî graceful degradation

## –¶–µ–ª–∏ —É—Ä–æ–∫–∞

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–∫–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ:

- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å LLM-as-a-judge –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–¥—ë–∂–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ fallback

## –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

- **LLM-as-a-judge** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–æ–π (–∏–ª–∏ —Ç–æ–π –∂–µ) LLM
- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å —É—á–µ–Ω–∏–∫–∞
- **Graceful degradation** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

## 1. LLM-as-a-judge: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∏–∑ –ú–æ–¥—É–ª—è 2

–í —É—Ä–æ–∫–µ 3 –º–æ–¥—É–ª—è 2 –º—ã –∏–∑—É—á–∏–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é LLM-as-a-judge ‚Äî –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥—Ä—É–≥–æ–π. –≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:

- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **–ø–æ–Ω—è—Ç–Ω—ã–º** –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞
- –ú–∞—Ç–µ—Ä–∏–∞–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–ø–æ–ª–Ω—ã–º**, –Ω–æ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–º
- –ü—Ä–∏–º–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º–∏** –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞
- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω **—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å** –∫–ª–∞—Å—Å—É

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è QualityChecker (`quality.py`)

```python
"""
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –¥–ª—è SchoolBot.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM-as-a-judge –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤.
"""

import json
import re
from typing import Dict, Optional, Tuple
from router import ModelRouter


class QualityChecker:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é LLM-as-a-judge.
    """
    
    def __init__(self, router: ModelRouter, min_score: float = 7.0, max_improvements: int = 2):
        """
        Args:
            router: –†–æ—É—Ç–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
            min_score: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–µ–º–ª–µ–º–∞—è –æ—Ü–µ–Ω–∫–∞ (1-10)
            max_improvements: –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ —É–ª—É—á—à–µ–Ω–∏—è
        """
        self.router = router
        self.min_score = min_score
        self.max_improvements = max_improvements
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.stats = {
            "checks": 0,
            "improvements": 0,
            "avg_score": 0.0
        }
    
    def check_explanation(self, 
                          topic: str, 
                          explanation: str, 
                          grade: int,
                          subject: str = "–æ–±—â–∏–π") -> Dict:
        """
        –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞.
        
        Args:
            topic: –¢–µ–º–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            explanation: –¢–µ–∫—Å—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            grade: –ö–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞ (9, 10, 11)
            subject: –ü—Ä–µ–¥–º–µ—Ç
            
        Returns:
            Dict —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
        """
        self.stats["checks"] += 1
        
        check_prompt = f"""–û—Ü–µ–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞ {grade} –∫–ª–∞—Å—Å–∞.

–ü—Ä–µ–¥–º–µ—Ç: {subject}
–¢–µ–º–∞: {topic}

–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:
---
{explanation}
---

–û—Ü–µ–Ω–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º (–∫–∞–∂–¥—ã–π –æ—Ç 1 –¥–æ 10):

1. –ü–û–ù–Ø–¢–ù–û–°–¢–¨: –ù–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ –∏ —è—Å–Ω–æ –∏–∑–ª–æ–∂–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª? 
   (10 = –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ —à–∫–æ–ª—å–Ω–∏–∫—É, 1 = —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ)

2. –ü–û–õ–ù–û–¢–ê: –í—Å–µ –ª–∏ –≤–∞–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Ç–µ–º—ã —Ä–∞—Å–∫—Ä—ã—Ç—ã?
   (10 = –ø–æ–ª–Ω–æ—Å—Ç—å—é, 1 = –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ)

3. –ü–†–ò–ú–ï–†–´: –ï—Å—Ç—å –ª–∏ –ø–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏?
   (10 = –æ—Ç–ª–∏—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã, 1 = –Ω–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤)

4. –°–¢–†–£–ö–¢–£–†–ê: –õ–æ–≥–∏—á–Ω–æ –ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª?
   (10 = –∏–¥–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, 1 = —Ö–∞–æ—Ç–∏—á–Ω–æ)

5. –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï –£–†–û–í–ù–Æ: –ü–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –¥–ª—è —É—á–µ–Ω–∏–∫–∞ {grade} –∫–ª–∞—Å—Å–∞?
   (10 = –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, 1 = –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç)

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:
{{
    "–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å": <—á–∏—Å–ª–æ>,
    "–ø–æ–ª–Ω–æ—Ç–∞": <—á–∏—Å–ª–æ>,
    "–ø—Ä–∏–º–µ—Ä—ã": <—á–∏—Å–ª–æ>,
    "—Å—Ç—Ä—É–∫—Ç—É—Ä–∞": <—á–∏—Å–ª–æ>,
    "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_—É—Ä–æ–≤–Ω—é": <—á–∏—Å–ª–æ>,
    "–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞": <—Å—Ä–µ–¥–Ω–µ–µ –æ—Ç –≤—Å–µ—Ö –æ—Ü–µ–Ω–æ–∫>,
    "—Å–∏–ª—å–Ω—ã–µ_—Å—Ç–æ—Ä–æ–Ω—ã": ["—Å—Ç–æ—Ä–æ–Ω–∞ 1", "—Å—Ç–æ—Ä–æ–Ω–∞ 2"],
    "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": ["—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2"]
}}"""

        messages = [
            {"role": "system", "content": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –æ—Ü–µ–Ω–∫–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤. –û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON."},
            {"role": "user", "content": check_prompt}
        ]
        
        result = self.router.send_request(
            messages=messages,
            task_type="quality_check",
            complexity="easy",
            max_tokens=500,
            temperature=0.3  # –ù–∏–∑–∫–∞—è –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
        )
        
        if not result["success"]:
            return {
                "success": False,
                "error": result["error"],
                "–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞": 0
            }
        
        # –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
        try:
            # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ë—Ä–Ω—É—Ç –≤ —Ç–µ–∫—Å—Ç)
            content = result["content"]
            json_match = re.search(r'\{[\s\S]*\}', content)
            if json_match:
                quality_data = json.loads(json_match.group())
            else:
                raise ValueError("JSON –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ")
            
            quality_data["success"] = True
            
            # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            score = quality_data.get("–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞", 0)
            self._update_avg_score(score)
            
            return quality_data
            
        except (json.JSONDecodeError, ValueError) as e:
            return {
                "success": False,
                "error": f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ü–µ–Ω–∫–∏: {e}",
                "–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞": 0,
                "raw_response": result["content"]
            }
    
    def improve_explanation(self,
                            topic: str,
                            explanation: str,
                            recommendations: list,
                            grade: int) -> str:
        """
        –£–ª—É—á—à–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
        
        Args:
            topic: –¢–µ–º–∞
            explanation: –ò—Å—Ö–æ–¥–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
            recommendations: –°–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
            grade: –ö–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞
            
        Returns:
            –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        """
        self.stats["improvements"] += 1
        
        improve_prompt = f"""–£–ª—É—á—à–∏ —Å–ª–µ–¥—É—é—â–µ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã "{topic}" –¥–ª—è —É—á–µ–Ω–∏–∫–∞ {grade} –∫–ª–∞—Å—Å–∞.

–ò—Å—Ö–æ–¥–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:
---
{explanation}
---

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:
{chr(10).join(f"‚Ä¢ {r}" for r in recommendations)}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –°–æ—Ö—Ä–∞–Ω–∏ –≤—Å—é –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
2. –£—á—Ç–∏ –í–°–ï —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é  
3. –°–¥–µ–ª–∞–π –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞ {grade} –∫–ª–∞—Å—Å–∞
4. –î–æ–±–∞–≤—å –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏, –µ—Å–ª–∏ –∏—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç
5. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π –º–∞—Ç–µ—Ä–∏–∞–ª —Å –ø–æ–º–æ—â—å—é —Å–ø–∏—Å–∫–æ–≤ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–π

–ù–∞–ø–∏—à–∏ –¢–û–õ–¨–ö–û —É–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:"""

        messages = [
            {"role": "system", "content": f"–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —É—á–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—ä—è—Å–Ω—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ {grade} –∫–ª–∞—Å—Å–∞."},
            {"role": "user", "content": improve_prompt}
        ]
        
        result = self.router.send_request(
            messages=messages,
            task_type="explain_simple",
            complexity="medium",
            max_tokens=2000,
            temperature=0.7
        )
        
        if result["success"]:
            return result["content"]
        else:
            return explanation  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    
    def ensure_quality(self,
                       topic: str,
                       explanation: str,
                       grade: int,
                       subject: str = "–æ–±—â–∏–π") -> Tuple[str, Dict]:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–ª—É—á—à–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–æ –ø—Ä–∏–µ–º–ª–µ–º–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.
        
        Args:
            topic: –¢–µ–º–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
            explanation: –ò—Å—Ö–æ–¥–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
            grade: –ö–ª–∞—Å—Å —É—á–µ–Ω–∏–∫–∞
            subject: –ü—Ä–µ–¥–º–µ—Ç
            
        Returns:
            Tuple[—É–ª—É—á—à–µ–Ω–Ω–æ–µ_–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –¥–∞–Ω–Ω—ã–µ_–∫–∞—á–µ—Å—Ç–≤–∞]
        """
        current_explanation = explanation
        
        for attempt in range(self.max_improvements + 1):
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ
            quality = self.check_explanation(topic, current_explanation, grade, subject)
            
            if not quality.get("success"):
                # –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                return current_explanation, quality
            
            score = quality.get("–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞", 0)
            
            # –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
            if score >= self.min_score:
                quality["improved"] = attempt > 0
                quality["improvement_attempts"] = attempt
                return current_explanation, quality
            
            # –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á—Ç–æ –µ—Å—Ç—å
            if attempt >= self.max_improvements:
                quality["improved"] = attempt > 0
                quality["improvement_attempts"] = attempt
                quality["note"] = "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ —É–ª—É—á—à–µ–Ω–∏—è"
                return current_explanation, quality
            
            # –ü—Ä–æ–±—É–µ–º —É–ª—É—á—à–∏—Ç—å
            recommendations = quality.get("—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏", [])
            if recommendations:
                print(f"   üìù –£–ª—É—á—à–∞—é –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})...")
                current_explanation = self.improve_explanation(
                    topic, current_explanation, recommendations, grade
                )
        
        return current_explanation, quality
    
    def _update_avg_score(self, new_score: float):
        """–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ä–µ–¥–Ω—é—é –æ—Ü–µ–Ω–∫—É"""
        n = self.stats["checks"]
        old_avg = self.stats["avg_score"]
        self.stats["avg_score"] = old_avg + (new_score - old_avg) / n
    
    def get_stats(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–≤–µ—Ä–æ–∫"""
        return self.stats.copy()


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ QualityChecker")
    print("="*50)
    
    router = ModelRouter()
    checker = QualityChecker(router, min_score=7.0)
    
    # –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ (–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –Ω–µ–∏–¥–µ–∞–ª—å–Ω–æ–µ)
    test_explanation = """
    –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–∏ - —ç—Ç–æ –ø—Ä–µ–¥–µ–ª –æ—Ç–Ω–æ—à–µ–Ω–∏—è –ø—Ä–∏—Ä–∞—â–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∫ –ø—Ä–∏—Ä–∞—â–µ–Ω–∏—é 
    –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø—Ä–∏ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫ –Ω—É–ª—é. –§–æ—Ä–º–∞–ª—å–Ω–æ: f'(x) = lim(Œîx‚Üí0) [f(x+Œîx) - f(x)] / Œîx.
    –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –¥–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ.
    """
    
    print("\nüìù –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π...")
    quality = checker.check_explanation(
        topic="–ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è",
        explanation=test_explanation,
        grade=11,
        subject="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    )
    
    if quality.get("success"):
        print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏:")
        print(f"   –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {quality.get('–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞', 'N/A')}/10")
        print(f"   –ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å: {quality.get('–ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å', 'N/A')}/10")
        print(f"   –ü—Ä–∏–º–µ—Ä—ã: {quality.get('–ø—Ä–∏–º–µ—Ä—ã', 'N/A')}/10")
        print(f"\n   üí™ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: {quality.get('—Å–∏–ª—å–Ω—ã–µ_—Å—Ç–æ—Ä–æ–Ω—ã', [])}")
        print(f"   üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: {quality.get('—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', [])}")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∞: {quality.get('error')}")
    
    print("\n" + "="*50)
    print("üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤—Ç–æ—É–ª—É—á—à–µ–Ω–∏–µ...")
    
    improved, final_quality = checker.ensure_quality(
        topic="–ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è",
        explanation=test_explanation,
        grade=11,
        subject="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"
    )
    
    print(f"\nüìä –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: {final_quality.get('–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞', 'N/A')}/10")
    print(f"   –£–ª—É—á—à–µ–Ω–æ: {final_quality.get('improved', False)}")
    print(f"   –ü–æ–ø—ã—Ç–æ–∫: {final_quality.get('improvement_attempts', 0)}")
```

## 2. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏–π –û–ì–≠ –∏ –ï–ì–≠

–î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç —ç–∫–∑–∞–º–µ–Ω–æ–≤:

**–û–ì–≠ (9 –∫–ª–∞—Å—Å):**
- –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –ó–∞–¥–∞–Ω–∏—è —Å –∫—Ä–∞—Ç–∫–∏–º –æ—Ç–≤–µ—Ç–æ–º
- –ó–∞–¥–∞–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º –æ—Ç–≤–µ—Ç–∞
- –ü—Ä–∞–∫—Ç–∏–∫–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–ï–ì–≠ (10-11 –∫–ª–∞—Å—Å):**
- –ë–∞–∑–æ–≤—ã–π –∏ –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
- –ó–∞–¥–∞–Ω–∏—è —Å –∫—Ä–∞—Ç–∫–∏–º –æ—Ç–≤–µ—Ç–æ–º
- –ó–∞–¥–∞–Ω–∏—è —Å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º
- –ó–∞–¥–∞—á–∏ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ExamQuizGenerator (`exam_quiz.py`)

```python
"""
–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠ –¥–ª—è SchoolBot.
"""

import re
import json
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass
from router import ModelRouter


@dataclass
class Question:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è"""
    number: int
    text: str
    question_type: str  # "short_answer", "multiple_choice", "detailed"
    options: Optional[List[str]] = None
    correct_answer: str = ""
    explanation: str = ""
    difficulty: str = "medium"
    topic: str = ""


class ExamQuizGenerator:
    """
    –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞–Ω–∏–π –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –û–ì–≠ –∏ –ï–ì–≠.
    """
    
    def __init__(self, router: ModelRouter):
        self.router = router
        
        # –¢–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π –ø–æ —ç–∫–∑–∞–º–µ–Ω–∞–º
        self.exam_types = {
            "oge": {
                "name": "–û–ì–≠",
                "grade": 9,
                "types": ["short_answer", "multiple_choice"],
                "difficulty_range": ["easy", "medium"]
            },
            "ege": {
                "name": "–ï–ì–≠",
                "grade": [10, 11],
                "types": ["short_answer", "multiple_choice", "detailed"],
                "difficulty_range": ["medium", "hard"]
            }
        }
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.stats = {
            "questions_generated": 0,
            "answers_checked": 0,
            "correct_answers": 0
        }
    
    def generate_questions(self,
                           topic: str,
                           subject: str,
                           exam_type: str = "ege",
                           num_questions: int = 3,
                           difficulty: str = "medium") -> List[Question]:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ —Ç–µ–º–µ.
        
        Args:
            topic: –¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏–π
            subject: –ü—Ä–µ–¥–º–µ—Ç
            exam_type: –¢–∏–ø —ç–∫–∑–∞–º–µ–Ω–∞ ('oge' –∏–ª–∏ 'ege')
            num_questions: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π
            difficulty: –°–ª–æ–∂–Ω–æ—Å—Ç—å ('easy', 'medium', 'hard')
            
        Returns:
            –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
        """
        exam_info = self.exam_types.get(exam_type, self.exam_types["ege"])
        
        prompt = f"""–°–æ–∑–¥–∞–π {num_questions} —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ —Ç–µ–º–µ "{topic}" –¥–ª—è —ç–∫–∑–∞–º–µ–Ω–∞ {exam_info['name']}.

–ü—Ä–µ–¥–º–µ—Ç: {subject}
–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: {difficulty}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–¥–∞–Ω–∏—è–º:
1. –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ {exam_info['name']}
2. –í–∫–ª—é—á–∏ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π:
   - –° –∫—Ä–∞—Ç–∫–∏–º –æ—Ç–≤–µ—Ç–æ–º (—á–∏—Å–ª–æ, —Å–ª–æ–≤–æ, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
   - –° –≤—ã–±–æ—Ä–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–∞ (4 –≤–∞—Ä–∏–∞–Ω—Ç–∞, –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
   {"- –° —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–º –æ—Ç–≤–µ—Ç–æ–º (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π)" if exam_type == "ege" else ""}
3. –°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É—Ä–æ–≤–Ω—é: {difficulty}
4. –ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –°–¢–†–û–ì–û JSON –º–∞—Å—Å–∏–≤:
[
  {{
    "number": 1,
    "type": "short_answer" –∏–ª–∏ "multiple_choice" –∏–ª–∏ "detailed",
    "text": "–¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è",
    "options": ["A) –≤–∞—Ä–∏–∞–Ω—Ç", "B) –≤–∞—Ä–∏–∞–Ω—Ç", "C) –≤–∞—Ä–∏–∞–Ω—Ç", "D) –≤–∞—Ä–∏–∞–Ω—Ç"] –∏–ª–∏ null,
    "correct_answer": "–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
    "explanation": "–ø–æ—á–µ–º—É —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π",
    "difficulty": "{difficulty}"
  }},
  ...
]

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤–æ–º, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞!"""

        messages = [
            {"role": "system", "content": f"–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏–π –¥–ª—è {exam_info['name']} –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É {subject}. –û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON."},
            {"role": "user", "content": prompt}
        ]
        
        result = self.router.send_request(
            messages=messages,
            task_type="generate_exam",
            complexity=difficulty,
            max_tokens=2500,
            temperature=0.8  # –í—ã—à–µ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        )
        
        if not result["success"]:
            return []
        
        # –ü–∞—Ä—Å–∏–º JSON
        try:
            content = result["content"]
            # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –º–∞—Å—Å–∏–≤
            json_match = re.search(r'\[[\s\S]*\]', content)
            if json_match:
                questions_data = json.loads(json_match.group())
            else:
                raise ValueError("JSON –º–∞—Å—Å–∏–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω")
            
            questions = []
            for q in questions_data:
                question = Question(
                    number=q.get("number", len(questions) + 1),
                    text=q.get("text", ""),
                    question_type=q.get("type", "short_answer"),
                    options=q.get("options"),
                    correct_answer=q.get("correct_answer", ""),
                    explanation=q.get("explanation", ""),
                    difficulty=q.get("difficulty", difficulty),
                    topic=topic
                )
                questions.append(question)
            
            self.stats["questions_generated"] += len(questions)
            return questions
            
        except (json.JSONDecodeError, ValueError) as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–¥–∞–Ω–∏–π: {e}")
            return []
    
    def format_questions_for_display(self, questions: List[Question]) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—á–µ–Ω–∏–∫—É (–±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤).
        """
        if not questions:
            return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è"
        
        output = []
        for q in questions:
            output.append(f"\n{'‚ïê'*50}")
            output.append(f"üìù –ó–ê–î–ê–ù–ò–ï {q.number}")
            if q.difficulty == "hard":
                output.append("   [–ü–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏]")
            output.append(f"{'‚îÄ'*50}")
            output.append(q.text)
            
            if q.options:
                output.append("")
                for option in q.options:
                    output.append(f"   {option}")
            
            output.append("")
            
            if q.question_type == "short_answer":
                output.append("üí° –í–≤–µ–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (—á–∏—Å–ª–æ, —Å–ª–æ–≤–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)")
            elif q.question_type == "multiple_choice":
                output.append("üí° –í–≤–µ–¥–∏—Ç–µ –±—É–∫–≤—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (A, B, C –∏–ª–∏ D)")
            else:
                output.append("üí° –ù–∞–ø–∏—à–∏—Ç–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç")
        
        output.append(f"\n{'‚ïê'*50}")
        return "\n".join(output)
    
    def check_answer(self,
                     question: Question,
                     student_answer: str) -> Dict:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ.
        
        Args:
            question: –ó–∞–¥–∞–Ω–∏–µ
            student_answer: –û—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
        """
        self.stats["answers_checked"] += 1
        
        # –î–ª—è –∑–∞–¥–∞–Ω–∏–π —Å –∫—Ä–∞—Ç–∫–∏–º –æ—Ç–≤–µ—Ç–æ–º –∏ –≤—ã–±–æ—Ä–æ–º ‚Äî —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é
        if question.question_type in ["short_answer", "multiple_choice"]:
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –æ—Ç–≤–µ—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
            correct = self._normalize_answer(question.correct_answer)
            student = self._normalize_answer(student_answer)
            
            is_correct = correct == student
            
            if is_correct:
                self.stats["correct_answers"] += 1
            
            return {
                "is_correct": is_correct,
                "correct_answer": question.correct_answer,
                "student_answer": student_answer,
                "explanation": question.explanation if not is_correct else "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ",
                "feedback": self._generate_feedback(is_correct, question)
            }
        
        # –î–ª—è —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º LLM
        return self._check_detailed_answer(question, student_answer)
    
    def _normalize_answer(self, answer: str) -> str:
        """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –æ—Ç–≤–µ—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è"""
        # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        normalized = answer.strip().lower()
        # –£–±–∏—Ä–∞–µ–º —Ç–æ—á–∫–∏, –∑–∞–ø—è—Ç—ã–µ –≤ –∫–æ–Ω—Ü–µ
        normalized = re.sub(r'[.,;:!?]+$', '', normalized)
        # –î–ª—è –±—É–∫–≤ (A, B, C, D) –±–µ—Ä—ë–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª
        if len(normalized) == 1 and normalized in 'abcd–∞–≤—Å–¥':
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ
            mapping = {'–∞': 'a', '–≤': 'b', '—Å': 'c', '–¥': 'd'}
            normalized = mapping.get(normalized, normalized)
        return normalized
    
    def _generate_feedback(self, is_correct: bool, question: Question) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è —É—á–µ–Ω–∏–∫–∞"""
        if is_correct:
            return "‚úÖ –û—Ç–ª–∏—á–Ω–æ! –¢—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ—à–∏–ª —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ."
        else:
            return f"""‚ùå –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π.

üìñ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: {question.correct_answer}

üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ: {question.explanation}

üìù –°–æ–≤–µ—Ç: –í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—á–∏—Ç–∞–π —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ø—Ä–æ–±—É–π —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ."""
    
    def _check_detailed_answer(self, question: Question, student_answer: str) -> Dict:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é LLM"""
        
        prompt = f"""–ü—Ä–æ–≤–µ—Ä—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ.

–ó–ê–î–ê–ù–ò–ï:
{question.text}

–≠–¢–ê–õ–û–ù–ù–´–ô –û–¢–í–ï–¢ (–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã):
{question.correct_answer}

–û–¢–í–ï–¢ –£–ß–ï–ù–ò–ö–ê:
{student_answer}

–û—Ü–µ–Ω–∏ –æ—Ç–≤–µ—Ç –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
1. –ü–æ–ª–Ω–æ—Ç–∞ –æ—Ç–≤–µ—Ç–∞ (–≤—Å–µ –ª–∏ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã —Ä–∞—Å–∫—Ä—ã—Ç—ã)
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–∫—Ç–æ–≤ –∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
3. –õ–æ–≥–∏–∫–∞ –∏–∑–ª–æ–∂–µ–Ω–∏—è

–û—Ç–≤–µ—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{{
    "score": <—á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 10>,
    "is_correct": <true –µ—Å–ª–∏ score >= 7, –∏–Ω–∞—á–µ false>,
    "strengths": ["—á—Ç–æ —Ö–æ—Ä–æ—à–æ –≤ –æ—Ç–≤–µ—Ç–µ"],
    "weaknesses": ["—á—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å"],
    "feedback": "–æ–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —É—á–µ–Ω–∏–∫–∞"
}}"""

        messages = [
            {"role": "system", "content": "–¢—ã ‚Äî —É—á–∏—Ç–µ–ª—å, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤. –ë—É–¥—å –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º, –Ω–æ –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–º."},
            {"role": "user", "content": prompt}
        ]
        
        result = self.router.send_request(
            messages=messages,
            task_type="check_answer",
            complexity="medium",
            max_tokens=500,
            temperature=0.3
        )
        
        if not result["success"]:
            return {
                "is_correct": None,
                "error": result["error"],
                "feedback": "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"
            }
        
        try:
            content = result["content"]
            json_match = re.search(r'\{[\s\S]*\}', content)
            if json_match:
                check_result = json.loads(json_match.group())
                check_result["correct_answer"] = question.correct_answer
                check_result["student_answer"] = student_answer
                
                if check_result.get("is_correct"):
                    self.stats["correct_answers"] += 1
                
                return check_result
            else:
                raise ValueError("JSON –Ω–µ –Ω–∞–π–¥–µ–Ω")
                
        except (json.JSONDecodeError, ValueError):
            return {
                "is_correct": None,
                "feedback": "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏",
                "raw_response": result["content"]
            }
    
    def run_quiz_session(self, questions: List[Question]) -> Dict:
        """
        –ü—Ä–æ–≤–æ–¥–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é —Å–µ—Å—Å–∏—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
        
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ—Å—Å–∏–∏
        """
        if not questions:
            return {"error": "–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"}
        
        results = {
            "total": len(questions),
            "correct": 0,
            "wrong": 0,
            "answers": []
        }
        
        print("\n" + "‚ïê"*50)
        print("üìù –ù–ê–ß–ò–ù–ê–ï–ú –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï")
        print("‚ïê"*50)
        print(f"–í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π: {len(questions)}")
        print("–í–≤–µ–¥–∏—Ç–µ '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ")
        print("–í–≤–µ–¥–∏—Ç–µ '—Å—Ç–æ–ø' —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –¥–æ—Å—Ä–æ—á–Ω–æ")
        
        for q in questions:
            print(f"\n{'‚îÄ'*50}")
            print(f"üìå –ó–∞–¥–∞–Ω–∏–µ {q.number} –∏–∑ {len(questions)}")
            print(f"{'‚îÄ'*50}")
            print(q.text)
            
            if q.options:
                print()
                for option in q.options:
                    print(f"   {option}")
            
            # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
            print()
            answer = input("‚úèÔ∏è –í–∞—à –æ—Ç–≤–µ—Ç: ").strip()
            
            if answer.lower() == "—Å—Ç–æ–ø":
                print("\n‚èπÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ")
                break
            
            if answer.lower() == "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å":
                results["wrong"] += 1
                results["answers"].append({
                    "question": q.number,
                    "skipped": True
                })
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
            check_result = self.check_answer(q, answer)
            
            if check_result.get("is_correct"):
                results["correct"] += 1
                print("\n‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!")
            else:
                results["wrong"] += 1
                print(f"\n{check_result.get('feedback', '–ù–µ–≤–µ—Ä–Ω–æ')}")
            
            results["answers"].append({
                "question": q.number,
                "student_answer": answer,
                "is_correct": check_result.get("is_correct"),
                "correct_answer": check_result.get("correct_answer")
            })
        
        # –ò—Ç–æ–≥–∏
        print("\n" + "‚ïê"*50)
        print("üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
        print("‚ïê"*50)
        print(f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {results['correct']} –∏–∑ {results['total']}")
        
        percentage = (results['correct'] / results['total']) * 100 if results['total'] > 0 else 0
        print(f"–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {percentage:.1f}%")
        
        if percentage >= 80:
            print("üåü –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!")
        elif percentage >= 60:
            print("üëç –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –µ—Å—Ç—å –Ω–∞–¥ —á–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å")
        else:
            print("üìö –†–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ–º—É –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑")
        
        return results
    
    def get_stats(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"""
        return self.stats.copy()


# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
if __name__ == "__main__":
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ExamQuizGenerator")
    print("="*50)
    
    router = ModelRouter()
    generator = ExamQuizGenerator(router)
    
    print("\nüìù –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ...")
    questions = generator.generate_questions(
        topic="–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è",
        subject="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
        exam_type="oge",
        num_questions=3,
        difficulty="medium"
    )
    
    if questions:
        print(f"\n‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {len(questions)} –∑–∞–¥–∞–Ω–∏–π")
        print(generator.format_questions_for_display(questions))
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–≤–µ—Ç–∞
        print("\n" + "="*50)
        print("üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–≤–µ—Ç–∞...")
        
        test_answer = "5"  # –ü—Ä–æ–±–Ω—ã–π –æ—Ç–≤–µ—Ç
        result = generator.check_answer(questions[0], test_answer)
        print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {result}")
    else:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è")
```

## 3. –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

–î–æ–±–∞–≤–∏–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é –∞–¥–∞–ø—Ç–∞—Ü–∏—é —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ø–µ—Ö–æ–≤ —É—á–µ–Ω–∏–∫–∞:

```python
"""
–°–∏—Å—Ç–µ–º–∞ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è SchoolBot.
–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ assistant.py –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª adaptive.py
"""

from typing import Dict, List
from dataclasses import dataclass, field


@dataclass
class StudentProgress:
    """–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–∞ –ø–æ —Ç–µ–º–µ"""
    topic: str
    correct_answers: int = 0
    total_answers: int = 0
    current_difficulty: str = "medium"
    difficulty_history: List[str] = field(default_factory=list)
    
    @property
    def success_rate(self) -> float:
        """–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤"""
        if self.total_answers == 0:
            return 0.0
        return self.correct_answers / self.total_answers
    
    def record_answer(self, is_correct: bool):
        """–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–≤–µ—Ç–∞"""
        self.total_answers += 1
        if is_correct:
            self.correct_answers += 1


class AdaptiveDifficultyManager:
    """
    –£–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é –Ω–∞ –æ—Å–Ω–æ–≤–µ —É—Å–ø–µ—Ö–æ–≤ —É—á–µ–Ω–∏–∫–∞.
    """
    
    def __init__(self):
        # –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–∞–º
        self.progress: Dict[str, StudentProgress] = {}
        
        # –ü–æ—Ä–æ–≥–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        self.thresholds = {
            "increase": 0.8,  # 80%+ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å
            "decrease": 0.4,  # 40%- –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å
            "min_answers": 3  # –ú–∏–Ω–∏–º—É–º –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
        }
        
        # –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π
        self.difficulty_order = ["easy", "medium", "hard"]
    
    def get_progress(self, topic: str) -> StudentProgress:
        """–ü–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ç–µ–º–µ"""
        if topic not in self.progress:
            self.progress[topic] = StudentProgress(topic=topic)
        return self.progress[topic]
    
    def record_answer(self, topic: str, is_correct: bool) -> str:
        """
        –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å.
        
        Args:
            topic: –¢–µ–º–∞
            is_correct: –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
            
        Returns:
            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        """
        progress = self.get_progress(topic)
        progress.record_answer(is_correct)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        if progress.total_answers >= self.thresholds["min_answers"]:
            new_difficulty = self._calculate_difficulty(progress)
            
            if new_difficulty != progress.current_difficulty:
                progress.difficulty_history.append(progress.current_difficulty)
                progress.current_difficulty = new_difficulty
                self._notify_difficulty_change(topic, new_difficulty, progress.success_rate)
        
        return progress.current_difficulty
    
    def _calculate_difficulty(self, progress: StudentProgress) -> str:
        """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å"""
        rate = progress.success_rate
        current_idx = self.difficulty_order.index(progress.current_difficulty)
        
        if rate >= self.thresholds["increase"]:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
            new_idx = min(current_idx + 1, len(self.difficulty_order) - 1)
        elif rate <= self.thresholds["decrease"]:
            # –£–º–µ–Ω—å—à–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
            new_idx = max(current_idx - 1, 0)
        else:
            # –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
            new_idx = current_idx
        
        return self.difficulty_order[new_idx]
    
    def _notify_difficulty_change(self, topic: str, new_difficulty: str, rate: float):
        """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏"""
        direction = "–ø–æ–≤—ã—à–µ–Ω–∞" if new_difficulty in ["medium", "hard"] else "–ø–æ–Ω–∏–∂–µ–Ω–∞"
        emoji = "üìà" if direction == "–ø–æ–≤—ã—à–µ–Ω–∞" else "üìâ"
        
        print(f"\n{emoji} –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ —Ç–µ–º–µ '{topic}' {direction} –¥–æ '{new_difficulty}'")
        print(f"   (–Ω–∞ –æ—Å–Ω–æ–≤–µ {rate*100:.0f}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤)")
    
    def get_recommendation(self, topic: str) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ–º—ã"""
        progress = self.get_progress(topic)
        
        return {
            "topic": topic,
            "current_difficulty": progress.current_difficulty,
            "success_rate": progress.success_rate,
            "total_answers": progress.total_answers,
            "recommendation": self._get_text_recommendation(progress)
        }
    
    def _get_text_recommendation(self, progress: StudentProgress) -> str:
        """–§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é"""
        if progress.total_answers < self.thresholds["min_answers"]:
            return "–ü—Ä–æ–¥–æ–ª–∂–∞–π —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —É—Ä–æ–≤–Ω—è"
        
        rate = progress.success_rate
        if rate >= 0.8:
            return "–û—Ç–ª–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã! –ú–æ–∂–µ—à—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–º –∑–∞–¥–∞–Ω–∏—è–º"
        elif rate >= 0.6:
            return "–•–æ—Ä–æ—à–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ"
        elif rate >= 0.4:
            return "–ï—Å—Ç—å –Ω–∞–¥ —á–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Ç–µ–æ—Ä–∏—é"
        else:
            return "–†–µ–∫–æ–º–µ–Ω–¥—É—é –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –±–∞–∑–æ–≤—ã–º –ø–æ–Ω—è—Ç–∏—è–º —Ç–µ–º—ã"
    
    def get_overall_stats(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ç–µ–º–∞–º"""
        total_correct = sum(p.correct_answers for p in self.progress.values())
        total_answers = sum(p.total_answers for p in self.progress.values())
        
        return {
            "topics_studied": len(self.progress),
            "total_answers": total_answers,
            "total_correct": total_correct,
            "overall_rate": total_correct / total_answers if total_answers > 0 else 0,
            "topics": {
                topic: {
                    "difficulty": p.current_difficulty,
                    "rate": p.success_rate,
                    "answers": p.total_answers
                }
                for topic, p in self.progress.items()
            }
        }
```

## 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SchoolAssistant

–û–±–Ω–æ–≤–∏–º –∫–ª–∞—Å—Å `SchoolAssistant` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```python
# –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ assistant.py:
from quality import QualityChecker
from exam_quiz import ExamQuizGenerator, Question
# from adaptive import AdaptiveDifficultyManager  # –ï—Å–ª–∏ —Å–æ–∑–¥–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª

# –í –º–µ—Ç–æ–¥–µ __init__ –¥–æ–±–∞–≤—å—Ç–µ:
def __init__(self):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
    self.quality_checker = QualityChecker(
        router=self.router,
        min_score=QUALITY_CONFIG["min_score"],
        max_improvements=QUALITY_CONFIG["max_improvements"]
    )
    print("   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞")
    
    self.exam_generator = ExamQuizGenerator(router=self.router)
    print("   ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤")
    
    self.adaptive = AdaptiveDifficultyManager()
    print("   ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å")
    
    # –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    self.current_questions: List[Question] = []


# –û–±–Ω–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ explain_topic –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:
def explain_topic(self, topic: str, check_quality: bool = True) -> str:
    """
    –û–±—ä—è—Å–Ω—è–µ—Ç —Ç–µ–º—É —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞—á–µ—Å—Ç–≤–∞.
    """
    if not self.router:
        return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
    
    # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
    recommendation = self.adaptive.get_recommendation(topic)
    adaptive_difficulty = recommendation["current_difficulty"]
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
    if recommendation["total_answers"] >= 3:
        effective_difficulty = adaptive_difficulty
        print(f"üìä –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: {effective_difficulty}")
    else:
        effective_difficulty = self.current_difficulty
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
    user_prompt = self.prompts.get_explain_prompt(
        topic=topic,
        grade=self.current_grade,
        difficulty=effective_difficulty
    )
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    self.context.add_message("user", f"–û–±—ä—è—Å–Ω–∏ —Ç–µ–º—É: {topic}", topic)
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è API
    messages = self.context.get_messages_for_api()
    messages.append({"role": "user", "content": user_prompt})
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–¥–∞—á–∏
    task_type = "explain_complex" if effective_difficulty == "hard" else "explain_simple"
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
    print(f"üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–µ–º—ã '{topic}'...")
    result = self.router.send_request(
        messages=messages,
        task_type=task_type,
        complexity=effective_difficulty,
        max_tokens=2000,
        temperature=0.7
    )
    
    if not result["success"]:
        return f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {result['error']}"
    
    explanation = result["content"]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É–ª—É—á—à–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ
    if check_quality and QUALITY_CONFIG["check_explanations"]:
        print("üîç –ü—Ä–æ–≤–µ—Ä—è—é –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è...")
        explanation, quality = self.quality_checker.ensure_quality(
            topic=topic,
            explanation=explanation,
            grade=self.current_grade,
            subject=self.current_subject
        )
        
        if quality.get("improved"):
            print(f"‚ú® –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —É–ª—É—á—à–µ–Ω–æ! –û—Ü–µ–Ω–∫–∞: {quality.get('–æ–±—â–∞—è_–æ—Ü–µ–Ω–∫–∞', 'N/A')}/10")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    self.context.add_message("assistant", explanation)
    
    return explanation


# –û–±–Ω–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ generate_exam:
def generate_exam(self, topic: str, exam_type: str = None, 
                  num_questions: int = 3) -> str:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠.
    """
    if not self.router:
        return "‚ùå –û—à–∏–±–∫–∞: —Ä–æ—É—Ç–µ—Ä –º–æ–¥–µ–ª–µ–π –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω"
    
    exam = exam_type or self.current_exam_type
    
    # –ü–æ–ª—É—á–∞–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å
    recommendation = self.adaptive.get_recommendation(topic)
    if recommendation["total_answers"] >= 3:
        difficulty = recommendation["current_difficulty"]
    else:
        difficulty = self.current_difficulty
    
    print(f"üìù –ì–µ–Ω–µ—Ä–∏—Ä—É—é {num_questions} –∑–∞–¥–∞–Ω–∏–π {exam.upper()} –ø–æ —Ç–µ–º–µ '{topic}'...")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–¥–∞–Ω–∏—è
    questions = self.exam_generator.generate_questions(
        topic=topic,
        subject=self.current_subject,
        exam_type=exam,
        num_questions=num_questions,
        difficulty=difficulty
    )
    
    if not questions:
        return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑."
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
    self.current_questions = questions
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    return self.exam_generator.format_questions_for_display(questions)


# –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ check_answer:
def check_answer(self, answer: str, question_number: int = 1) -> str:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ.
    
    Args:
        answer: –û—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞
        question_number: –ù–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è (–Ω–∞—á–∏–Ω–∞—è —Å 1)
        
    Returns:
        –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    """
    if not self.current_questions:
        return "‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π /exam"
    
    if question_number < 1 or question_number > len(self.current_questions):
        return f"‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä –∑–∞–¥–∞–Ω–∏—è. –î–æ—Å—Ç—É–ø–Ω—ã: 1-{len(self.current_questions)}"
    
    question = self.current_questions[question_number - 1]
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
    result = self.exam_generator.check_answer(question, answer)
    
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
    is_correct = result.get("is_correct", False)
    self.adaptive.record_answer(question.topic, is_correct)
    
    return result.get("feedback", "–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")


# –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
def get_learning_stats(self) -> Dict:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—É—á–µ–Ω–∏—è"""
    return {
        "adaptive": self.adaptive.get_overall_stats(),
        "quality": self.quality_checker.get_stats(),
        "exams": self.exam_generator.get_stats(),
        "router": self.router.get_stats() if self.router else {}
    }
```

## 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLI –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–î–æ–±–∞–≤—å—Ç–µ –≤ `main.py` –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤:

```python
# –í –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –¥–æ–±–∞–≤—å—Ç–µ:

elif command == "/check" or command == "/answer":
    if args:
        # –ü–∞—Ä—Å–∏–º: /check [–Ω–æ–º–µ—Ä] –æ—Ç–≤–µ—Ç
        parts = args.split(maxsplit=1)
        
        if len(parts) == 2 and parts[0].isdigit():
            num = int(parts[0])
            answer = parts[1]
        else:
            num = 1
            answer = args
        
        result = assistant.check_answer(answer, num)
        print(f"\n{result}")
    else:
        print("‚ùå –£–∫–∞–∂–∏—Ç–µ –æ—Ç–≤–µ—Ç: /check 1 –≤–∞—à_–æ—Ç–≤–µ—Ç")
        print("   –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ: /check –≤–∞—à_–æ—Ç–≤–µ—Ç (–¥–ª—è –∑–∞–¥–∞–Ω–∏—è 1)")

elif command == "/progress":
    stats = assistant.get_learning_stats()
    adaptive = stats.get("adaptive", {})
    
    print(f"\nüìä –ü–†–û–ì–†–ï–°–° –û–ë–£–ß–ï–ù–ò–Ø")
    print(f"{'‚îÄ'*40}")
    print(f"–ò–∑—É—á–µ–Ω–æ —Ç–µ–º: {adaptive.get('topics_studied', 0)}")
    print(f"–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: {adaptive.get('total_answers', 0)}")
    print(f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: {adaptive.get('total_correct', 0)}")
    
    overall_rate = adaptive.get('overall_rate', 0)
    print(f"–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç: {overall_rate*100:.1f}%")
    
    topics = adaptive.get('topics', {})
    if topics:
        print(f"\nüìö –ü–æ —Ç–µ–º–∞–º:")
        for topic, data in topics.items():
            print(f"   ‚Ä¢ {topic}: {data['rate']*100:.0f}% ({data['difficulty']})")
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### üü¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python quality.py` –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
- –û—Ü–µ–Ω–∫—É –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –û—Ü–µ–Ω–∫—É —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

**–ó–∞–¥–∞–Ω–∏–µ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ `python exam_quiz.py` –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç—ã:
- 3 –∑–∞–¥–∞–Ω–∏—è –û–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ
- 5 –∑–∞–¥–∞–Ω–∏–π –ï–ì–≠ –ø–æ —Ñ–∏–∑–∏–∫–µ

### üü° –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 3: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏**
–î–æ–±–∞–≤—å—Ç–µ –≤ `QualityChecker` —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏:
- –ù–∞–ª–∏—á–∏–µ —Ñ–æ—Ä–º—É–ª
- –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- –ß–∏—Å–ª–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã

**–ó–∞–¥–∞–Ω–∏–µ 4: –¢–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º**
–†–∞—Å—à–∏—Ä—å—Ç–µ `ExamQuizGenerator`, –¥–æ–±–∞–≤–∏–≤ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–∏–ø—ã –∑–∞–¥–∞–Ω–∏–π:
- –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞: –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—è, –ø—É–Ω–∫—Ç—É–∞—Ü–∏—è
- –î–ª—è –∏—Å—Ç–æ—Ä–∏–∏: —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è, –ø—Ä–∏—á–∏–Ω–Ω–æ-—Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏

### üî¥ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å

**–ó–∞–¥–∞–Ω–∏–µ 5: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**
–†–∞—Å—à–∏—Ä—å—Ç–µ `AdaptiveDifficultyManager`:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–º –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –Ω–∞ —ç–∫–∑–∞–º–µ–Ω–µ

**–ó–∞–¥–∞–Ω–∏–µ 6: –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π**
–î–æ–±–∞–≤—å—Ç–µ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—é:
- –ë–µ–π–¥–∂–∏ –∑–∞ —Å–µ—Ä–∏—é –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –£—Ä–æ–≤–Ω–∏ "–º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞" –ø–æ —Ç–µ–º–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞ –Ω–µ–¥–µ–ª—é

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   LLM –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–µ, –Ω–µ–ø–æ–ª–Ω—ã–µ –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Ä–æ–≤–Ω—é —É—á–µ–Ω–∏–∫–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è. QualityChecker —Å –ø–æ–º–æ—â—å—é LLM-as-a-judge –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å, –ø–æ–ª–Ω–æ—Ç—É, –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ª—É—á—à–∞–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–æ –ø—Ä–∏–µ–º–ª–µ–º–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.
   </details>

2. **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ. –ï—Å–ª–∏ —É—á–µ–Ω–∏–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ 80%+ –∑–∞–¥–∞–Ω–∏–π ‚Äî —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç—Å—è. –ï—Å–ª–∏ –º–µ–Ω–µ–µ 40% ‚Äî –ø–æ–Ω–∏–∂–∞–µ—Ç—Å—è. –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 –æ—Ç–≤–µ—Ç–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–ª–µ–±–∞–Ω–∏–π.
   </details>

3. **–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—Ç–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–≥–æ?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç (—á–∏—Å–ª–æ, —Å–ª–æ–≤–æ, –±—É–∫–≤–∞) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä—è–º—ã–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏. –†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç —Ç—Ä–µ–±—É–µ—Ç LLM –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –ø–æ–ª–Ω–æ—Ç—ã, –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –∏ –ª–æ–≥–∏–∫–∏ –∏–∑–ª–æ–∂–µ–Ω–∏—è.
   </details>

4. **–ü–æ—á–µ–º—É –≤–∞–∂–µ–Ω —Ñ–æ—Ä–º–∞—Ç –û–ì–≠/–ï–ì–≠ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –®–∫–æ–ª—å–Ω–∏–∫–∏ –≥–æ—Ç–æ–≤—è—Ç—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —ç–∫–∑–∞–º–µ–Ω–∞–º —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∑–∞–¥–∞–Ω–∏–π. –ü—Ä–∞–∫—Ç–∏–∫–∞ –≤ –∑–Ω–∞–∫–æ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (—Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤) –ª—É—á—à–µ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É —ç–∫–∑–∞–º–µ–Ω—É, —á–µ–º –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏.
   </details>

5. **–ö–∞–∫–∏–µ fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö?**
   <details>
   <summary>–û—Ç–≤–µ—Ç</summary>
   –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ ‚Äî –ø—Ä–æ–±—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ. –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ. –ü—Ä–∏ –æ—à–∏–±–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞–Ω–∏–π ‚Äî –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
   </details>

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ —É—Ä–æ–∫–∞

### –ß—Ç–æ –º—ã –∏–∑—É—á–∏–ª–∏

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" –≤ SchoolBot:

- **QualityChecker** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- **ExamQuizGenerator** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–¥–∞–Ω–∏–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —ç–∫–∑–∞–º–µ–Ω–æ–≤
- **AdaptiveDifficultyManager** ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥ —É—Å–ø–µ—Ö–∏ —É—á–µ–Ω–∏–∫–∞
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî graceful degradation –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

### –°–≤—è–∑—å —Å –ú–æ–¥—É–ª–µ–º 2

–ú—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
- **–£—Ä–æ–∫ 3:** LLM-as-a-judge ‚Üí –Ω–∞—à QualityChecker
- **–£—Ä–æ–∫ 2:** Fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–µ–∑–¥–µ
- **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–æ–º–ø—Ç—ã:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ JSON

### –ß—Ç–æ –Ω–∞—Å –∂–¥—ë—Ç –¥–∞–ª—å—à–µ

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ **"–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"** –º—ã:
- –ó–∞–≤–µ—Ä—à–∏–º CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- –î–æ–±–∞–≤–∏–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Å—Å–∏–π
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —à–∫–æ–ª—å–Ω—ã—Ö —Ç–µ–º–∞—Ö
- –°–æ–∑–¥–∞–¥–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞

### –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å

üéì **SchoolBot —Å—Ç–∞–ª —É–º–Ω–µ–µ!** –¢–µ–ø–µ—Ä—å –æ–Ω:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–≤–æ–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ –û–ì–≠/–ï–ì–≠
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç—ã —É—á–µ–Ω–∏–∫–æ–≤
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —É—Ä–æ–≤–Ω—é –∫–∞–∂–¥–æ–≥–æ —É—á–µ–Ω–∏–∫–∞
- ‚úÖ Gracefully –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–ì–æ—Ç–æ–≤—ã –∫ —Ñ–∏–Ω–∏—à—É?** –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ [–£—Ä–æ–∫—É 4: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](lesson_4_finalization.md)!

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### LLM-as-a-Judge:
- [Judging LLM-as-a-Judge](https://arxiv.org/abs/2306.05685)
- [Self-Refine: Iterative Refinement with Self-Feedback](https://arxiv.org/abs/2303.17651)

### –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ:
- [Intelligent Tutoring Systems](https://en.wikipedia.org/wiki/Intelligent_tutoring_system)
- [Personalized Learning](https://www.edutopia.org/article/personalized-learning)

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤:
- [Automatic Question Generation](https://aclanthology.org/)
- [–§–ò–ü–ò ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª—ã —ç–∫–∑–∞–º–µ–Ω–æ–≤](https://fipi.ru/)

